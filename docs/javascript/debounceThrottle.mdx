---
sideBar_position: 2
---

# é˜²æŠ–ä¸èŠ‚æµ

>å¼•è¨€ï¼šä¸ç®¡æ˜¯é¢è¯•ä¸­è¿˜æ˜¯å®é™…åº”ç”¨ï¼Œé˜²æŠ–ä¸èŠ‚æµéƒ½æ˜¯æˆ‘ä»¬æ¯”ä¸å¯å°‘çš„ä¸€é—¨æŠ€èƒ½

:::info
**é˜²æŠ–ä¾‹å¦‚ï¼Ÿ**
+ ğŸ–¥å‡å¦‚ä¸æ“ä½œç”µè„‘ååˆ†é’Ÿåï¼Œä¼šè§¦å‘ç†„å±å‡½æ•°ï¼Œç„¶åç”µè„‘ä¼šç†„å±ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚æœåœ¨ååˆ†é’Ÿå†…æ“ä½œäº†ç”µè„‘ï¼Œå°†ä¼šé‡æ–°è®¡æ—¶ååˆ†é’Ÿ
+ ğŸ“œå‡å¦‚è½®æ’­å›¾æ¯è¿‡äº”ç§’ä¼šè‡ªåŠ¨ç¿»é¡µï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ‰‹åŠ¨ç‚¹å‡»ç¿»é¡µæ—¶ï¼Œä¼šé‡æ–°è®¡æ—¶äº”ç§’ï¼Œé˜²æ­¢çªç„¶è·³ä¸¤é¡µçš„å¥‡æ€ªæƒ…å†µå‘ç”Ÿ

**èŠ‚æµä¾‹å¦‚ï¼Ÿ**
+ ğŸ–±è®¸å¤šç½‘ç«™å½“é¡µé¢æ»šåŠ¨åˆ°ä¸€å®šè·ç¦»ï¼Œä¼šå‡ºç°å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®ï¼ŒèŠ‚æµå¯ä»¥å¸®åŠ©æˆ‘ä»¬å‡å°‘è§¦å‘æ»šåŠ¨äº‹ä»¶çš„æ¬¡æ•°
+ ğŸ”˜æäº¤æŒ‰é’®çš„æ—¶å€™ï¼Œä»æœ‰éƒ¨åˆ†äººå–œæ¬¢ç‹‚ç‚¹æŒ‰é’®ï¼ŒèŠ‚æµå¯ä»¥è®©å…¶ä¸ç®¡ç‚¹å‡»å¤šå°‘æ¬¡ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…åªèƒ½ç”Ÿæ•ˆä¸€æ¬¡
:::
## é˜²æŠ–çš„ç»å…¸å®ç°

é˜²æŠ–å‡½æ•°å¸¸ç”¨äºDOMäº‹ä»¶ä¸­
```javascript
function debounce(fn, delay) { //1. ç‚¹å‡»è§¦å‘çš„å‡½æ•°æ˜¯debouceå‡½æ•°çš„è¿”å›å€¼
    let timeout = null
    return function() { //2. ä¹Ÿå°±æ˜¯è¿™ä¸ªå‡½æ•°
        clearTimeout(timeout)
        timeout = setTimeout(() => { //å†æ¬¡è§¦å‘å°±é‡æ–°è®¡æ—¶
            fn()
        }, delay)
    }
}
//æµ‹è¯•
function fn() {
    console.log('é™æ­¢äº†1s')
}
window.onmousemove = debounce(fn, 1000)
```
ä¸Šé¢jsä»£ç æ„å‘³ç€é¼ æ ‡ç§»åŠ¨åä¼šè§¦å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯**debounce**å‡½æ•°çš„è¿”å›å€¼ï¼ˆå³`debounce()`ï¼‰

ä¸‹é¢çš„gifæ˜¯ä¸Šé¢ä»£ç çš„å®ä¾‹å±•ç¤ºï¼Œè§‚å¯Ÿæ§åˆ¶å°çš„è¾“å‡ºï¼Œé¼ æ ‡é™æ­¢1såæ‰ä¼šè§¦å‘å‡½æ•°ç„¶åè¾“å‡ºï¼š

export const Image = ({path}) => {
    return (
        <img style={{boxShadow: "2px 2px 30px #c7ccd7"}} src={path}></img>
    )
}

<Image path="https://img-blog.csdnimg.cn/20210505184907959.gif"/>

## èŠ‚æµçš„ç»å…¸å®ç°

```javascript
function throttle(fn, delay) {
    let canRun = true
    return function() {
        if (!canRun) return
        
        canRun = false
        setTimeout(() => {
            fn()
            canRun = true
        }, delay)
    }
}
//æµ‹è¯•
function fn() {
    console.log('ç§»åŠ¨ä¸­...')
}
window.onmousemove = throttle(fn, 1000)
```
ä¸ç®¡å¦‚ä½•ç§»åŠ¨ï¼Œå‡½æ•°`fn`æœ€å¤šæ¯ç§’è§¦å‘ä¸€æ¬¡ï¼š

<Image path="https://img-blog.csdnimg.cn/20210505185442826.gif"/>


## æ— å®šæ—¶å™¨çš„èŠ‚æµ

èŠ‚æµçš„æ ¸å¿ƒåœ¨äºå¦‚æœä¸¤æ¬¡è§¦å‘çš„æ—¶é—´å·®å°äºè§„å®šçš„æ—¶é—´ï¼Œåˆ™è®©è¯¥æ¬¡è§¦å‘ä½œåºŸ

âœ”ï¸æ‰€ä»¥èŠ‚æµæœ‰ç¬¬äºŒç§å®ç°æ–¹å¼ï¼š
```javascript
function throttle2(fn, delay) { 
    let time = null
    return function() {
        if (!null || +new Date() - time > delay) {
            fn()
            time = +new Date()
        }
    }
}
```
ä¸¤ç§èŠ‚æµæ•ˆæœç›¸å½“ï¼Œä¸è¿‡åœ¨å°‘æ•°çš„æƒ…å†µä¸‹æœ‰åŒºåˆ«ï¼š
+ ä¸¤è€…ç¡®å®šæ—¶é—´çš„ç²¾åº¦ä¸ä¸€æ ·
+ `new Date()`ä¾èµ–ä¸æœ¬åœ°æ—¶é—´ï¼Œè€Œå®šæ—¶å™¨ä¾èµ–äºjså¼•æ“

## å¼•å…¥thisçš„æƒ…å†µ

æ— è®ºä½•æ—¶ä½•åœ°ï¼Œjsçš„**this**æŒ‡å‘æ°¸è¿œéƒ½æ˜¯ä¸€ä¸ªå¤´ç–¼çš„é—®é¢˜ï¼Œä¸€åˆ‡çš„æ ¹æºéƒ½æ¥è‡ªäºå‡½æ•°å¯ä»¥ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œåœ¨é˜²æŠ–ä¸èŠ‚æµä¸­ï¼Œä¹Ÿéœ€è¦æ³¨æ„è¿™ä¸ªé—®é¢˜

ä»¥èŠ‚æµå‡½æ•°ä¸ºä¾‹å­ï¼š
```javascript
function throttle(fn, delay) {
    let canRun = true
    return function() {
        if (!canRun) return
        canRun = false
        setTimeout(() => {
            fn()
            canRun = true
        }, delay)
    }
}
let a = {
    name: 'lihua',
    sayName() {
        console.log(this.name)
    }
}
setInterval(throttle(a.sayName, 2000), 100)

/* æ¯éš”2sè¾“å‡ºä¸€ä¸ªundefined
  undefined
  undefined
  ......
*/
```
åŸå› æ˜¯è°ƒç”¨è¯¥å‡½æ•°çš„æ˜¯å…¨å±€globalå¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­æ˜¯window

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å¾—ä¼ å…¥æœŸæœ›è°ƒç”¨è¯¥å‡½æ•°çš„å¯¹è±¡ï¼š
```javascript
function throttle(fn, delay) {
    let canRun = true
    return function(...args) {
        if (!canRun) return
        canRun = false
        setTimeout(() => {
            fn.apply(args[0])  //è®©aå¯¹è±¡è°ƒç”¨æ­¤å‡½æ•°
            canRun = true
        }, delay)
    }
}
let a = {
    name: 'lihua',
    sayName() {
        console.log(this.name)
    }
}
setInterval(throttle(a.sayName, 2000), 100, a) //ä¼ å…¥aå¯¹è±¡ 
/* æ¯éš”2sè¾“å‡ºä¸€ä¸ªlihua
  lihua
  lihua
  ......
*/
```
éœ€è¦æ³¨æ„çš„æ˜¯ï¼š
:::tip
å®šæ—¶å™¨çš„ç¬¬ä¸‰ä¸ªåŠå…¶ä¹‹åçš„å‚æ•°ä¼šä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ï¼Œæ‰€ä»¥å®é™…ä¸Šä¼šè¢«`...args`æ”¶é›†åˆ° 
:::

## é”™è¯¯çš„å®ç°ï¼
åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæœ‰éƒ¨åˆ†äººå¹¶æ²¡æœ‰ç†è§£é˜²æŠ–ä¸èŠ‚æµå‡½æ•°çš„ç”¨æ³•ï¼Œä¾‹å¦‚å¦‚ä¸‹çš„åšæ³•æ˜¯é”™è¯¯çš„
```js
function throttle(fn, delay) {
    let canRun = true
    return function() {
        if (!canRun) return
        canRun = false
        setTimeout(() => {
            fn()
            canRun = true
        }, delay)
    }
}

function output() {
    console.log(123)
}
setInterval(() => {
    throttle(output, 2000)  //éœ€è¦æ‰§è¡Œçš„å‡½æ•°æ˜¯throttleçš„è¿”å›å‡½æ•°ï¼Œè€Œä¸æ˜¯throttleæœ¬èº«!!!
}, 1000)
```
:::caution
è¿™æ˜¯æ–°æ‰‹åŠå…¶å®¹æ˜“çŠ¯çš„é”™ï¼Œå¦‚ä¸‹çš„ä»£ç æ‰æˆ–è®¸ä»£è¡¨æ‚¨çœŸæ­£çš„æƒ³æ³•ï¼š
```js
setInterval(() => {
    throttle(output, 2000)()
}, 1000)
```
:::